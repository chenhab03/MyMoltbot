<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>æƒ…ä¾£é£è¡Œæ£‹ ğŸ’•</title>
  <style>
    body{font-family:system-ui,-apple-system;background:#0f172a;color:#e5e7eb;display:flex;justify-content:center;align-items:center;min-height:100vh}
    .app{background:#020617;border-radius:16px;padding:16px;width:360px;box-shadow:0 20px 40px rgba(0,0,0,.4)}
    h1{margin:0 0 8px 0;font-size:20px;text-align:center}
    .hint{font-size:12px;opacity:.8;text-align:center;margin-bottom:8px}
    .board{display:grid;grid-template-columns:repeat(6,1fr);gap:6px;margin:12px 0}
    .cell{aspect-ratio:1;border:1px solid #1e293b;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:10px;position:relative}
    .cell.finish{background:#022c22;border-color:#14532d}
    .token{width:16px;height:16px;border-radius:50%;position:absolute}
    .a{background:#38bdf8}
    .b{background:#f472b6}
    .controls{display:flex;gap:8px}
    button{flex:1;padding:10px;border-radius:8px;border:none;background:#38bdf8;color:#020617;font-weight:bold;cursor:pointer}
    .status{margin-top:8px;font-size:13px;text-align:center}
    .card{margin-top:8px;padding:8px;border-radius:8px;background:#020617;border:1px solid #1e293b;font-size:12px}
  </style>
</head>
<body>
  <div class="app">
    <h1>âœˆï¸ æƒ…ä¾£é£è¡Œæ£‹</h1>
    <div class="hint">è½®æµæ·éª°å­ï¼Œå…ˆåˆ°ç»ˆç‚¹è€…è·èƒœã€‚é€”ä¸­æœ‰ç”œèœœäº‹ä»¶ ğŸ’–</div>
    <div id="board" class="board"></div>
    <div class="controls">
      <button id="roll">æ·éª°å­ ğŸ²</button>
      <button id="reset" style="background:#64748b">é‡æ¥</button>
    </div>
    <div id="status" class="status"></div>
    <div id="card" class="card">äº‹ä»¶å¡å°†åœ¨è¿™é‡Œæ˜¾ç¤º</div>
  </div>

<script>
const SIZE = 30; // 6x5
const events = {
  3: 'ç‰µæ‰‹å‰è¿› +1',
  6: 'æ‹¥æŠ±ä¸€ä¸‹ï¼Œå†èµ° +2',
  9: 'ç”œèœœå›å¿†ï¼Œè·³åˆ° 12',
  14:'å°äº‰æ‰§ï¼Œåé€€ 1',
  18:'æƒŠå–œçº¦ä¼šï¼Œå‰è¿› 3',
  22:'è¿·è·¯äº†ï¼Œå›åˆ° 20'
};

let state = JSON.parse(localStorage.getItem('couple-flight')) || {
  turn: 'A',
  A: 0,
  B: 0,
  finished: false
};

const board = document.getElementById('board');
const statusEl = document.getElementById('status');
const cardEl = document.getElementById('card');

function save(){ localStorage.setItem('couple-flight', JSON.stringify(state)); }

function buildBoard(){
  board.innerHTML='';
  for(let i=1;i<=SIZE;i++){
    const c=document.createElement('div');
    c.className='cell'+(i===SIZE?' finish':'');
    c.textContent=i;
    c.id='cell-'+i;
    board.appendChild(c);
  }
}

function placeTokens(){
  document.querySelectorAll('.token').forEach(t=>t.remove());
  if(state.A>0){ const t=document.createElement('div'); t.className='token a'; document.getElementById('cell-'+state.A)?.appendChild(t);} 
  if(state.B>0){ const t=document.createElement('div'); t.className='token b'; document.getElementById('cell-'+state.B)?.appendChild(t);} 
}

function applyEvent(player){
  const pos = state[player];
  if(events[pos]){
    cardEl.textContent = events[pos];
    if(pos===3) state[player]+=1;
    if(pos===6) state[player]+=2;
    if(pos===9) state[player]=12;
    if(pos===14) state[player]-=1;
    if(pos===18) state[player]+=3;
    if(pos===22) state[player]=20;
  } else {
    cardEl.textContent = 'æ²¡æœ‰äº‹ä»¶ï¼Œç»§ç»­å‰è¿› ğŸ’«';
  }
}

function update(){
  placeTokens();
  if(state.finished){ statusEl.textContent='æ¸¸æˆç»“æŸ'; return; }
  statusEl.textContent = `è½®åˆ° ${state.turn==='A'?'ä½ ':'TA'} æ·éª°å­`;
  save();
}

function roll(){
  if(state.finished) return;
  const dice = Math.ceil(Math.random()*6);
  const p = state.turn;
  state[p] += dice;
  if(state[p] >= SIZE){ state[p]=SIZE; state.finished=true; cardEl.textContent = `${p==='A'?'ä½ ':'TA'} è·èƒœ ğŸ‰`; update(); return; }
  applyEvent(p);
  state.turn = p==='A'?'B':'A';
  update();
}

function reset(){ state={turn:'A',A:0,B:0,finished:false}; save(); buildBoard(); update(); }

document.getElementById('roll').onclick=roll;
document.getElementById('reset').onclick=reset;

buildBoard(); update();
</script>
</body>
</html>